<?php
    function helper_add_tournament($name, $type, $url, $optional = array())
    {
        $tournament = new ChallongeTournament(); 

        $tournament_params = array();
        $tournament_params['tournament'] = $optional;
        $tournament_params['tournament']['name'] = $name;    
        $tournament_params['tournament']['type'] = $type;    
        $tournament_params['tournament']['url'] = $url;    

        $tournament->setParams($tournament_params);
        $tournament->reqCreate();
    }

    function helper_add_matches($tournament_url, $match_data)
    {
    }

    /**Creates a challonge participant using the user's sc2 character name. */
    function helper_add_particpant($tournament_id, $uid)
    {
       //Get's the sc2name from the sc2ranks module.   
       $char_name_field = variable_get("sc2ranks_name_profile_field", "profile_character_name");
       $result = db_query(
                          'SELECT {profile_fields}.name, {profile_values}.value
                           FROM {profile_values}
                           LEFT JOIN {profile_fields} ON {profile_values}.fid = {profile_fields}.fid
                           WHERE {profile_values}.uid = %d
                           AND {profile_fileds}.name IN (\'%s\')', $uid, $char_name_field);
       $char_info = db_fetch_object($result);
       //TODO: check for nulls
       $paricipant_params['participant']['name'] = $char_info ->name; 
       $participant = new ChallongeParticipant($tournament_id);
      
       $participant->setParmas($participant_params);
       $participant->reqCreate();
    }
    function helper_update_cache()
    {
    }

    /**************************************
     *     New tournament form            *
     **************************************/

    function challonge_tournament()
    {
        return drupal_get_form('challonge_tournament_form');
    }
    function challonge_tournament_form(&$node, $form_state)
    {
        $form['tournament'] = array(
            '#type' => 'fieldset',
            '#title' => t('Tournament'),
            '#collaspible' => FALSE,
            '#collapsed' => FALSE,
         );
        $form['tournament']['Name'] = array(
                           '#type' => 'textfield',
                           '#title' => t('Name'),
                           '#required' => TRUE,
                            );
        $form['tournament']['type'] = array(
                           '#type' => 'radios',
                           '#title'=> 'type',
                           '#options' => array('single elimination', 
                                               'double elimination',
                                               'swiss',
                                               'round robin'),
                           '#required' => TRUE,
                        );
        $form['tournament']['url'] = array(
                            '#type' => 'textfield',
                            '#title' => t('URL'),
                            '#required' => TRUE
                            );
        $form['tournament']['description'] = array(
                                             '#type' => 'textarea',
                                             '#title' => t('Description'),
                                             '#required'=> FALSE);
        $form['tournament']['submit'] = array(
                                          '#type' => 'submit',
                                          '#value' => 'Submit',
                                        );
        return $form;
    }
    function challonge_tournament_form_validate($form, &$form_state)
    {
    }

    /**
     * Implementation of hook_perm
     */
    function challonge_perm()
    {
        return array('administer challonge');
    }

    function challonge_theme()
    {

    }
    function challonge_admin()
    {
    }

    /**
     * Implementation of hook_menu
     */
    function challonge_menu()
    {
        return array(
            'admin/settings/challonge' => array(
                'title' => t('Challonge'),
                'description' => t('Adjust the settings for the Challonge module.'),
                'file' => 'challonge.admin.inc',
                'page callback' => 'drupal_get_form',
                'page arguments' => array('challonge_settings_form'),
                'access arguments' => array('administer challonge'),
                'type' => MENU_NORMAL_ITEM
            )
        );
    }

    function challonge_profile_alter(&$account)
    {
    }

